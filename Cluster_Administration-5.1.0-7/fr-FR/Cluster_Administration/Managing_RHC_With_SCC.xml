<?xml version='1.0'?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % RH_ENTITIES SYSTEM "Common_Content/Entities.ent">
%RH_ENTITIES;
<!ENTITY % RH_TRANS_ENTITIES SYSTEM "Common_Content/Translatable-Entities.ent">
%RH_TRANS_ENTITIES;
]>

<chapter id="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster">
	<title>Managing &RH; Cluster With <command>system-config-cluster</command></title>
	<indexterm>
		<primary>cluster administration</primary>
	</indexterm>
	<indexterm>
		<primary>cluster</primary>
		<secondary>administration</secondary>
	</indexterm>
	<para>
		This chapter describes various administrative tasks for managing a &RH; Cluster and consists of the following sections:
	</para>
	<itemizedlist>
		<listitem>
			<para>
				<xref linkend="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Starting_and_Stopping_the_Cluster_Software" />
			</para>
		</listitem>
		<listitem>
			<para>
				<xref linkend="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Managing_High_Availability_Services" />
			</para>
		</listitem>
		<listitem>
			<para>
				<xref linkend="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Backing_Up_and_Restoring_the_Cluster_Database" />
			</para>
		</listitem>
		<listitem>
			<para>
				<xref linkend="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Disabling_the_Cluster_Software" />
			</para>
		</listitem>
		<listitem>
			<para>
				<xref linkend="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Diagnosing_and_Correcting_Problems_in_a_Cluster" />
			</para>
		</listitem>
	</itemizedlist>
	<section id="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Starting_and_Stopping_the_Cluster_Software">
		<title>Starting and Stopping the Cluster Software</title>
		<indexterm>
			<primary>cluster administration</primary>
			<secondary>starting and stopping the cluster software</secondary>
		</indexterm>
		<indexterm>
			<primary>cluster software</primary>
			<secondary>starting and stopping</secondary>
		</indexterm>
		<indexterm>
			<primary>System V <filename>init</filename></primary>
		</indexterm>
		<para>
			To start the cluster software on a member, type the following commands in this order:
		</para>
		<orderedlist>
			<listitem>
				<para>
					<command> service cman start</command>
				</para>
			</listitem>
			<listitem>
				<para>
					<command>service clvmd start</command>
				</para>
			</listitem>
			<listitem>
				<para>
					<command>service gfs start</command>, if you are using &RHGFS;
				</para>
			</listitem>
			<listitem>
				<para>
					<command>service rgmanager start</command>
				</para>
			</listitem>
		</orderedlist>
		<para>
			To stop the cluster software on a member, type the following commands in this order:
		</para>
		<orderedlist>
			<listitem>
				<para>
					<command>service rgmanager stop</command>
				</para>
			</listitem>
			<listitem>
				<para>
					<command>service gfs stop</command>, if you are using &RHGFS;
				</para>
			</listitem>
			<listitem>
				<para>
					<command>service clvmd stop</command>
				</para>
			</listitem>
			<listitem>
				<para>
					<command>service cman stop</command>
				</para>
			</listitem>
		</orderedlist>
		<para>
			Stopping the cluster services on a member causes its services to fail over to an active member.
		</para>
	</section>
	
	<section id="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Managing_High_Availability_Services">
		<title>Managing High-Availability Services</title>
		<para>
			You can manage cluster services with the <application>&RHCLUSTERSTATTOOL;</application> (<xref linkend="Cluster_Administration-Managing_High_Availability_Services-RHCLUSTERSTATTOOL" />) through the <guimenu>Cluster Management</guimenu> tab in Cluster Administration GUI.
		</para>
		<figure id="Cluster_Administration-Managing_High_Availability_Services-RHCLUSTERSTATTOOL">
			<title><application>&RHCLUSTERSTATTOOL;</application></title>
			<mediaobject>
				<imageobject>
					<imagedata fileref="./images/clustatus.png" />
				</imageobject>
				<textobject>
					<para>
						cluster status tool
					</para>
				</textobject>
			</mediaobject>
		</figure>
		<para>
			You can use the <application>&RHCLUSTERSTATTOOL;</application> to enable, disable, restart, or relocate a high-availability service. The <application>&RHCLUSTERSTATTOOL;</application> displays the current cluster status in the <guimenu>Services </guimenu> area and automatically updates the status every 10 seconds.
		</para>
		<para>
			To enable a service, you can select the service in the <guimenu>Services</guimenu> area and click <guiicon>Enable</guiicon>. To disable a service, you can select the service in the <guimenu>Services</guimenu> area and click <guiicon>Disable</guiicon>. To restart a service, you can select the service in the <guimenu>Services</guimenu> area and click <guiicon>Restart</guiicon>. To relocate a service from one node to another, you can drag the service to another node and drop the service onto that node. Relocating a service restarts the service on that node. (Relocating a service to its current node &mdash; that is, dragging a service to its current node and dropping the service onto that node &mdash; restarts the service.)
		</para>
		<indexterm>
			<primary>cluster administration</primary>
			<secondary>displaying cluster and service status</secondary>
		</indexterm>
		<indexterm>
			<primary>cluster</primary>
			<secondary>displaying status</secondary>
		</indexterm>
		<indexterm>
			<primary>cluster service</primary>
			<secondary>displaying status</secondary>
		</indexterm>
		<para>
			The following tables describe the members and services status information displayed by the <application>&RHCLUSTERSTATTOOL;</application>.
		</para>
		<table id="Cluster_Administration-Managing_High_Availability_Services-Members_Status">
			<title>Members Status</title>
			<tgroup cols="2">
				<colspec colname="MemberStatus" colnum="1" colwidth="3*"></colspec>
				<colspec colname="Description" colnum="2" colwidth="9*"></colspec>
				<thead>
					<row>
						<entry>
							Members Status
						</entry>
						<entry>
							Description
						</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>
							<guimenu>Member</guimenu>
						</entry>
						<entry>
							<simplelist>
								<member>The node is part of the cluster.</member>
								<member>Note: A node can be a member of a cluster; however, the node may be inactive and incapable of running services. For example, if <command>rgmanager</command> is not running on the node, but all other cluster software components are running in the node, the node appears as a <guimenu>Member</guimenu> in the <application>&RHCLUSTERSTATTOOL;</application>. </member>
							</simplelist>
						</entry>
					</row>
					<row>
						<entry>
							<guimenu>Dead</guimenu>
						</entry>
						<entry>
							The node is unable to participate as a cluster member. The most basic cluster software is not running on the node.
						</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
		<table id="Cluster_Administration-Managing_High_Availability_Services-Services_Status">
			<title>Services Status</title>
			<tgroup cols="2">
				<colspec colname="ServiceStatus" colnum="1" colwidth="3*"></colspec>
				<colspec colname="Description" colnum="2" colwidth="9*"></colspec>
				<thead>
					<row>
						<entry>
							Services Status
						</entry>
						<entry>
							Description
						</entry>
					</row>
				</thead>
				<tbody>
					<row>
						<entry>
							<guimenu>Started</guimenu>
						</entry>
						<entry>
							The service resources are configured and available on the cluster system that owns the service.
						</entry>
					</row>
					<row>
						<entry>
							<guimenu>Pending</guimenu>
						</entry>
						<entry>
							The service has failed on a member and is pending start on another member.
						</entry>
					</row>
					<row>
						<entry>
							<guimenu>Disabled</guimenu>
						</entry>
						<entry>
							The service has been disabled, and does not have an assigned owner. A disabled service is never restarted automatically by the cluster.
						</entry>
					</row>
					<row>
						<entry>
							<guimenu>Stopped</guimenu>
						</entry>
						<entry>
							The service is not running; it is waiting for a member capable of starting the service. A service remains in the stopped state if autostart is disabled.
						</entry>
					</row>
					<row>
						<entry>
							<guimenu>Failed</guimenu>
						</entry>
						<entry>
							The service has failed to start on the cluster and cannot successfully stop the service. A failed service is never restarted automatically by the cluster.
						</entry>
					</row>
				</tbody>
			</tgroup>
		</table>
	</section>
	
	<section id="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Modifying_the_Cluster_Configuration">
		<title>Modifying the Cluster Configuration</title>
		<indexterm>
			<primary>cluster administration</primary>
			<secondary>modifying the cluster configuration</secondary>
		</indexterm>
		<indexterm>
			<primary>cluster configuration</primary>
			<secondary>modifying</secondary>
		</indexterm>
		<para>
			To modify the cluster configuration (the cluster configuration file (<filename>/etc/cluster/cluster.conf</filename>), use the <application>&RHCLUSTERTOOL;</application>. For more information about using the <application>&RHCLUSTERTOOL;</application>, refer to <xref linkend="Cluster_Administration-Configuring_RH_Cluster_With_system_config_cluster" />.
		</para>
		<warning>
			<title>Warning</title>
			<para>
				Do not manually edit the contents of the <filename>/etc/cluster/cluster.conf</filename> file without guidance from an authorized &RH; representative or unless you fully understand the consequences of editing the <filename>/etc/cluster/cluster.conf</filename> file manually.
			</para>
		</warning>
		<important>
			<title>Important</title>
			<para>
				Although the <application>&RHCLUSTERTOOL;</application> provides a <guimenu>Quorum Votes</guimenu> parameter in the <guilabel>Properties</guilabel> dialog box of each cluster member, that parameter is intended <emphasis>only</emphasis> for use during initial cluster configuration. Furthermore, it is recommended that you retain the default <guimenu>Quorum Votes</guimenu> value of <userinput>1</userinput>. For more information about using the <application>&RHCLUSTERTOOL;</application>, refer to <xref linkend="Cluster_Administration-Configuring_RH_Cluster_With_system_config_cluster" />.
			</para>
		</important>
		<para>
			To edit the cluster configuration file, click the <guimenu>Cluster Configuration</guimenu> tab in the cluster configuration GUI. Clicking the <guimenu>Cluster Configuration</guimenu> tab displays a graphical representation of the cluster configuration. Change the configuration file according the the following steps:
		</para>
		<orderedlist>
			<listitem>
				<para>
					Make changes to cluster elements (for example, create a service).
				</para>
			</listitem>
			<listitem>
				<para>
					Propagate the updated configuration file throughout the cluster by clicking <guibutton>Send to Cluster</guibutton>.
				</para>
				<note>
					<title>Note</title>
					<para>
						The <application>&RHCLUSTERTOOL;</application> does not display the <guibutton>Send to Cluster</guibutton> button if the cluster is new and has not been started yet, or if the node from which you are running the <application>&RHCLUSTERTOOL;</application> is not a member of the cluster. If the <guibutton>Send to Cluster</guibutton> button is not displayed, you can still use the <application>&RHCLUSTERTOOL;</application>; however, you cannot propagate the configuration. You can still <emphasis>save</emphasis> the configuration file. For information about using the <application>&RHCLUSTERTOOL;</application> for a new cluster configuration, refer to <xref linkend="Cluster_Administration-Configuring_RH_Cluster_With_system_config_cluster" />.
					</para>
				</note>
			</listitem>
			<listitem>
				<para>
					Clicking <guibutton>Send to Cluster</guibutton> causes a <guilabel>Warning</guilabel> dialog box to be displayed. Click <guibutton>Yes</guibutton> to save and propagate the configuration.
				</para>
			</listitem>
			<listitem>
				<para>
					Clicking <guibutton>Yes</guibutton> causes an <guilabel>Information</guilabel> dialog box to be displayed, confirming that the current configuration has been propagated to the cluster. Click <guibutton>OK</guibutton>.
				</para>
			</listitem>
			<listitem>
				<para>
					Click the <guimenu>Cluster Management</guimenu> tab and verify that the changes have been propagated to the cluster members.
				</para>
			</listitem>
		</orderedlist>
	</section>
	
	<section id="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Backing_Up_and_Restoring_the_Cluster_Database">
		<title>Backing Up and Restoring the Cluster Database</title>
		<indexterm>
			<primary>cluster administration</primary>
			<secondary>backing up the cluster database</secondary>
		</indexterm>
		<indexterm>
			<primary>cluster database</primary>
			<secondary>backing up</secondary>
		</indexterm>
		<indexterm>
			<primary>cluster administration</primary>
			<secondary>restoring the cluster database</secondary>
		</indexterm>
		<indexterm>
			<primary>cluster database</primary>
			<secondary>restoring</secondary>
		</indexterm>
		<para>
			The <application>&RHCLUSTERTOOL;</application> automatically retains backup copies of the three most recently used configuration files (besides the currently used configuration file). Retaining the backup copies is useful if the cluster does not function correctly because of misconfiguration and you need to return to a previous working configuration.
		</para>
		<para>
			Each time you save a configuration file, the <application>&RHCLUSTERTOOL;</application> saves backup copies of the three most recently used configuration files as <filename>/etc/cluster/cluster.conf.bak.1</filename>, <filename>/etc/cluster/cluster.conf.bak.2</filename>, and <filename>/etc/cluster/cluster.conf.bak.3</filename>. The backup file <filename>/etc/cluster/cluster.conf.bak.1</filename> is the newest backup, <filename>/etc/cluster/cluster.conf.bak.2</filename> is the second newest backup, and <filename>/etc/cluster/cluster.conf.bak.3</filename> is the third newest backup.
		</para>
		<para>
			If a cluster member becomes inoperable because of misconfiguration, restore the configuration file according to the following steps:
		</para>
		<orderedlist>
			<listitem>
				<para>
					At the <application>&RHCLUSTERTOOL;</application> tab of the &RHCS; management GUI, click <guimenu>File</guimenu> =&gt; <guimenuitem>Open</guimenuitem>.
				</para>
			</listitem>
			<listitem>
				<para>
					Clicking <guimenu>File =&gt; Open</guimenu> causes the <guilabel>system-config-cluster</guilabel> dialog box to be displayed.
				</para>
			</listitem>
			<listitem>
				<para>
					At the the <guilabel>system-config-cluster</guilabel> dialog box, select a backup file (for example, <filename>/etc/cluster/cluster.conf.bak.1</filename>). Verify the file selection in the <guimenu>Selection</guimenu> box and click <guibutton>OK</guibutton>.
				</para>
			</listitem>
			<listitem>
				<para>
					Increment the configuration version beyond the current working version number as follows:
				</para>
				<orderedlist>
					<listitem>
						<para>
							Click <guimenu>Cluster</guimenu> =&gt; <guimenu>Edit Cluster Properties</guimenu>.
						</para>
					</listitem>
					<listitem>
						<para>
							At the <guilabel>Cluster Properties</guilabel> dialog box, change the <guimenu>Config Version</guimenu> value and click <guibutton>OK</guibutton>.
						</para>
					</listitem>
				</orderedlist>
			</listitem>
			<listitem>
				<para>
					Click <guimenu>File</guimenu> =&gt; <guimenuitem>Save As</guimenuitem>.
				</para>
			</listitem>
			<listitem>
				<para>
					Clicking <guimenu>File</guimenu> =&gt; <guimenuitem>Save As</guimenuitem> causes the <guilabel>system-config-cluster</guilabel> dialog box to be displayed.
				</para>
			</listitem>
			<listitem>
				<para>
					At the the <guilabel>system-config-cluster</guilabel> dialog box, select <filename>/etc/cluster/cluster.conf</filename> and click <guibutton>OK</guibutton>. (Verify the file selection in the <guimenu>Selection</guimenu> box.)
				</para>
			</listitem>
			<listitem>
				<para>
					Clicking <guibutton>OK</guibutton> causes an <guilabel>Information</guilabel> dialog box to be displayed. At that dialog box, click <guibutton>OK</guibutton>.
				</para>
			</listitem>
			<listitem>
				<para>
					Propagate the updated configuration file throughout the cluster by clicking <guibutton>Send to Cluster</guibutton>.
				</para>
				<note>
					<title>Note</title>
					<para>
						The <application>&RHCLUSTERTOOL;</application> does not display the <guibutton>Send to Cluster</guibutton> button if the cluster is new and has not been started yet, or if the node from which you are running the <application>&RHCLUSTERTOOL;</application> is not a member of the cluster. If the <guibutton>Send to Cluster</guibutton> button is not displayed, you can still use the <application>&RHCLUSTERTOOL;</application>; however, you cannot propagate the configuration. You can still <emphasis>save</emphasis> the configuration file. For information about using the <application>&RHCLUSTERTOOL;</application> for a new cluster configuration, refer to <xref linkend="Cluster_Administration-Configuring_RH_Cluster_With_system_config_cluster" />.
					</para>
				</note>
			</listitem>
			<listitem>
				<para>
					Clicking <guibutton>Send to Cluster</guibutton> causes a <guilabel>Warning</guilabel> dialog box to be displayed. Click <guibutton>Yes</guibutton> to propagate the configuration.
				</para>
			</listitem>
			<listitem>
				<para>
					Click the <guimenu>Cluster Management</guimenu> tab and verify that the changes have been propagated to the cluster members.
				</para>
			</listitem>
		</orderedlist>
	</section>
	
	<section id="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Disabling_the_Cluster_Software">
		<title>Disabling the Cluster Software</title>
		<indexterm>
			<primary>cluster administration</primary>
			<secondary>disabling the cluster software</secondary>
		</indexterm>
		<indexterm>
			<primary>cluster</primary>
			<secondary>disabling the cluster software</secondary>
		</indexterm>
		<indexterm>
			<primary>cluster software</primary>
			<secondary>disabling</secondary>
		</indexterm>
		<para>
			It may become necessary to temporarily disable the cluster software on a cluster member. For example, if a cluster member experiences a hardware failure, you may want to reboot that member, but prevent it from rejoining the cluster to perform maintenance on the system.
		</para>
		<para>
			Use the <command>/sbin/chkconfig</command> command to stop the member from joining the cluster at boot-up as follows:
		</para>
<screen>
# <userinput>chkconfig --level 2345 rgmanager off</userinput>
# <userinput>chkconfig --level 2345 gfs off</userinput>
# <userinput>chkconfig --level 2345 clvmd off</userinput>
# <userinput>chkconfig --level 2345 cman off</userinput></screen>
		<para>
			Once the problems with the disabled cluster member have been resolved, use the following commands to allow the member to rejoin the cluster:
		</para>
<screen>
# <userinput>chkconfig --level 2345 rgmanager on</userinput>
# <userinput>chkconfig --level 2345 gfs on</userinput>
# <userinput>chkconfig --level 2345 clvmd on</userinput>
# <userinput>chkconfig --level 2345 cman on</userinput></screen>
		<para>
			You can then reboot the member for the changes to take effect or run the following commands in the order shown to restart cluster software:
		</para>
		<orderedlist>
			<listitem>
				<para>
					<command>service cman start</command>
				</para>
			</listitem>
			<listitem>
				<para>
					<command>service clvmd start</command>
				</para>
			</listitem>
			<listitem>
				<para>
					<command>service gfs start</command>, if you are using &RHGFS;
				</para>
			</listitem>
			<listitem>
				<para>
					<command>service rgmanager start</command>
				</para>
			</listitem>
		</orderedlist>
	</section>
	
	<section id="Cluster_Administration-Managing_RH_Cluster_With_system_config_cluster-Diagnosing_and_Correcting_Problems_in_a_Cluster">
		<title>Diagnosing and Correcting Problems in a Cluster</title>
		<indexterm>
			<primary>cluster administration</primary>
			<secondary>diagnosing and correcting problems in a cluster</secondary>
		</indexterm>
		<indexterm>
			<primary>cluster</primary>
			<secondary>diagnosing and correcting problems</secondary>
		</indexterm>
		<indexterm>
			<primary>troubleshooting</primary>
			<secondary>diagnosing and correcting problems in a cluster</secondary>
		</indexterm>
		<para>
			For information about diagnosing and correcting problems in a cluster, contact an authorized Red Hat support representative.
		</para>
	</section>

</chapter>

